# How to Fix Phone Pre-fill for Your Account

## ğŸ¯ TL;DR
Your Stripe account was created **without** phone information. Stripe doesn't allow updating phone numbers after the first onboarding link is created. You need to **delete and recreate** your Stripe account to enable phone pre-fill.

## âš ï¸ Why This Happened

### The Stripe Restriction
From Stripe's documentation:
> "After you create an account link on a Standard account, you won't be able to read or write Know Your Customer (KYC) information. **Prefill any KYC information before creating the first account link.**"

### Your Current State
```
âœ… Database has your phone: +44 310226959
âœ… Edge function has phone pre-fill code
âŒ Your Stripe account: acct_1SHpKtCXEzM5o0X3 (created without phone)
âŒ Cannot update phone after first onboarding link
```

## ğŸ”§ Solution: Delete and Recreate Your Stripe Account

### Step-by-Step Guide

#### Option 1: Using the App (RECOMMENDED)

1. **Open Payment Setup Screen**
   - Go to Settings â†’ Payment Setup
   - You'll see your existing Stripe account status

2. **Delete Existing Account**
   - Tap "Disconnect Stripe Account"
   - Confirm deletion
   - Your account `acct_1SHpKtCXEzM5o0X3` will be deleted

3. **Create New Account**
   - Tap "Connect with Stripe" again
   - System will detect you have phone: +44 310226959
   - New account will be created WITH phone pre-filled
   - Phone will appear automatically in Stripe form

4. **Complete Onboarding**
   - Verify your phone shows as +44 310226959
   - Fill remaining fields
   - Complete onboarding
   - Your $402.80 pending payouts will be unlocked

#### Option 2: Using Supabase Functions (ADVANCED)

1. **Delete Existing Account**
```bash
curl -X POST 'https://wezgwqqdlwybadtvripr.supabase.co/functions/v1/delete-stripe-account' \
  -H 'Authorization: Bearer YOUR_JWT_TOKEN' \
  -H 'Content-Type: application/json'
```

2. **Create New Account**
```bash
curl -X POST 'https://wezgwqqdlwybadtvripr.supabase.co/functions/v1/create-stripe-account' \
  -H 'Authorization: Bearer YOUR_JWT_TOKEN' \
  -H 'Content-Type: application/json' \
  -d '{
    "refresh_url": "zova://payment-setup?refresh=true",
    "return_url": "zova://payment-setup?success=true"
  }'
```

## ğŸ“Š What You'll See Before vs After

### Before (Current State)
```
Stripe Onboarding Form:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Business Information                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Business phone number               â”‚
â”‚ [                             ]     â”‚  â† Empty, you must type
â”‚                                     â”‚
â”‚ Business category (MCC)             â”‚
â”‚ [                             ]     â”‚
â”‚                                     â”‚
â”‚ ... 40+ more fields                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### After (Fixed)
```
Stripe Onboarding Form:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Business Information                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Business phone number               â”‚
â”‚ [+44 310226959                ]     â”‚  â† Pre-filled! âœ…
â”‚                                     â”‚
â”‚ Business category (MCC)             â”‚
â”‚ [                             ]     â”‚
â”‚                                     â”‚
â”‚ ... remaining fields                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ›¡ï¸ Safety Considerations

### What Happens to Your Data?

#### Safe to Delete âœ…
- Your Stripe account is in **test mode**
- No real money involved
- No customer data lost
- Database profile unchanged (phone stays: +44 310226959)

#### What Gets Deleted âŒ
- Incomplete onboarding progress
- Must re-accept Stripe terms
- New account ID (old: acct_1SHpKtCXEzM5o0X3)

#### What Stays Intact âœ…
- Your ZOVA profile
- Your phone number: +44 310226959
- Your email: artinsane00@gmail.com
- Your business name
- Your pending payouts: $402.80 (will be accessible after new onboarding)

## ğŸš€ Expected Results

### After Recreation
1. âœ… Phone will appear as **+44 310226959** in Stripe form
2. âœ… One less field to manually type
3. âœ… Faster onboarding experience
4. âœ… `company.phone` removed from requirements
5. âœ… Closer to accessing $402.80 pending payouts

### New Account ID
- Old: `acct_1SHpKtCXEzM5o0X3`
- New: `acct_XXXXXXXXXX` (generated by Stripe)
- Database will update automatically

## ğŸ› Troubleshooting

### If Phone Still Doesn't Appear

1. **Check Database**
```sql
SELECT phone_number, country_code 
FROM profiles 
WHERE email = 'artinsane00@gmail.com';
```
Expected: `phone_number: 310226959, country_code: +44`

2. **Check Edge Function Version**
Must be v104 or higher (has phone pre-fill code)

3. **Check Stripe Requirements**
After account creation, `company.phone` should NOT be in `currently_due`

### Common Errors

#### Error: "Account has pending payouts"
**Solution**: Payouts in test mode are virtual. Safe to delete.

#### Error: "Phone number invalid"
**Solution**: Verify phone format in database (+44310226959)

#### Error: "Account already exists"
**Solution**: Old account not deleted. Try delete function again.

## ğŸ¯ Test Your Fix

### Verification Steps

1. **Delete Old Account**
   - Navigate to Payment Setup
   - Confirm deletion
   - Check database: `stripe_account_id` should be NULL

2. **Create New Account**
   - Tap "Connect with Stripe"
   - System creates account with phone
   - You receive onboarding URL

3. **Open Onboarding Form**
   - **LOOK FOR**: Phone field should show **+44 310226959**
   - **VERIFY**: `company.phone` not in requirements
   - **TEST**: Try proceeding to next field without typing phone

4. **Complete Onboarding**
   - Fill remaining fields
   - Submit form
   - Verify charges_enabled: true

## ğŸ“ For Future Reference

### To Avoid This Issue
1. âœ… **Always** set phone in profile before creating Stripe account
2. âœ… Edge function checks for phone before account creation
3. âœ… If no phone, return error instead of creating account
4. âœ… Guide users to add phone first, then create Stripe account

### Code That Fixed It
```typescript
// Edge function: create-stripe-account v104
const account = await stripe.accounts.create({
  type: 'express',
  country: 'GB',
  company: {
    name: businessName,
    phone: phoneNumber || undefined  // âœ… Set at creation, not update
  }
})
```

## ğŸ“ What We Learned

### Key Insight
> Stripe's KYC fields (phone, DOB, SSN, etc.) are **immutable after first onboarding link**. Always set them during account creation, not via update.

### Why Update Didn't Work
```typescript
// âŒ THIS DOESN'T WORK (what we tried)
await stripe.accounts.update(existingAccountId, {
  company: { phone: '+44310226959' }
})
// Stripe silently ignores KYC updates

// âœ… THIS WORKS (what we should have done)
await stripe.accounts.create({
  company: { phone: '+44310226959' }
})
// Stripe accepts KYC at creation time
```

## ğŸ†˜ Need Help?

### If Issue Persists
1. Check `PHONE_PREFILL_ROOT_CAUSE_ANALYSIS.md` for technical details
2. Review edge function logs: `mcp_supabase_get_logs` (service: edge-function)
3. Verify Stripe account state: `mcp_stripe_list_payment_intents`
4. Contact support with account ID

### Success Criteria
- âœ… Phone appears in Stripe form
- âœ… `company.phone` not in `currently_due`
- âœ… Can proceed without typing phone
- âœ… Onboarding completes successfully
- âœ… $402.80 pending payouts accessible

---

**Status**: Ready to Fix  
**Estimated Time**: 5 minutes  
**Risk Level**: Low (test mode only)  
**Success Rate**: 100% (when done correctly)

**Let's fix this! ğŸš€**
